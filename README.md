# Import Module

Модуль **Import** предназначен для импорта различных сущностей (категории, продукты, бренды и т.д.) из внешнего источника в систему с использованием событий, очередей и фасадов необходимой бизнес-логики.

---

## Основные возможности:

- **Универсальный процесс импорта.** Импорт поддерживает работу с различными сущностями, включая категории, продукты, бренды, фильтры и другие.
- **Вызов событий перед постановкой задач в очередь.** Для каждой сущности генерируется отдельное событие, которое можно использовать для предварительной обработки данных или других операций.
- **Поддержка очередей.** Данные обрабатываются через задачи в очереди, что улучшает масштабируемость и предотвращает блокировки.
- **Консольные команды.** Предоставляется команда `import`, позволяющая выбрать сущности, задать лимит и номер страницы для импорта.
- **Расширяемость.** Бизнес-логика реализована в виде интерфейсов, что позволяет легко добавлять новых импортеров.
- **Обработка ошибок.** Реализованы механизмы логирования и исключений для описания ошибок в процессе импорта.

---

## Как использовать

### Консольная команда импорта

Для запуска импорта используется универсальная консольная команда:
```bash
php artisan import
```

После запуска вы сможете:
1. Выбрать сущность для импорта (например, `Category`, `Product`, `Brand` и т.д.).
2. Указать лимит элементов для импорта.
3. Задать номер страницы для обработки.

Каждая указанная сущность вызывается через предварительно настроенный процесс обработки:
1. Трансформация данных из источника с использованием DTO.
2. Отправка события, связанного с сущностью (например, `CategoryImportEvent` для категорий).
3. Постановка данных на выполнение через очередь (соответствующий `Job`).

### Настройка внешнего сервиса
Конфигурация импорта хранится в файле `config/services.php`. Для корректной работы необходимо указать:
- URL сервиса импорта.
- Ключ авторизации.

Пример:
```php
'website_import' => [
    'url' => env('WEBSITE_IMPORT_URL'),
    'key' => env('WEBSITE_IMPORT_KEY'),
],
```

### События и работа с задачами очереди
1. Каждая сущность связывается с соответствующим событием. Например:
    - `CategoryImportEvent` уведомляет о начале обработки категории.
    - `BrandImportEvent` аналогично выполняет действие для брендов.
2. После подготовки данные направляются в очередь для дальнейшей асинхронной обработки.

Пример процесса для сущности `categories`:
- Данные преобразуются с использованием трансфера `CategoryResponseDto`.
- Генерируется событие `CategoryImportEvent`.
- Затем данные отправляются на выполнение задачи `CategoryImport`.

---

## Основные компоненты

### 1. **WebsiteReceiver**

Работает с внешними запросами:
- Формирует запросы к источнику данных импорта.
- Обрабатывает ответы и валидирует их.
- Выбрасывает исключения при возникновении ошибок (например, `ImportResponseException`).

***

### 2. **EntityImportConnector**

Служит универсальным обработчиком данных:
- Формирует поток данных для импорта (`stream`).
- Определяет, какое событие/задача относятся к сущности.
- Контролирует корректность данных и выбрасывает исключения.

***

### 3. **Events**

Каждая сущность имеет связанное событие:
- Событие генерируется до постановки задач в очередь, предоставляя возможность кастомной обработки данных.
- Пример событий: `CategoryImportEvent`, `ProductImportEvent`, `BrandImportEvent`.

***

### 4. **Jobs**

Для каждой сущности предусмотрена отдельная задача для обработки данных:
- Пример: `CategoryImport`, `BrandImport`, `ProductImport`.
- Задачи отвечают за сохранение, валидацию и бизнес-логику работы с импортируемыми данными.

---

## Расширяемость

Добавление новой сущности в процесс импорта требует:
1. Реализации нового `Job` для обработки данных сущности.
2. Создания события для сущности, если требуется обработка до очереди.
3. Указания сущности в конфигурации импорта (например, `import_entities` в `import.php`).
4. Реализации DTO, если структура данных отличается.

---
